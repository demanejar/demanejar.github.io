<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-9TR0K3B846"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8714452693053438" crossorigin="anonymous"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-9TR0K3B846'); </script><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Docker cơ bản và thực hành" /><meta name="author" content="viethoang" /><meta property="og:locale" content="en_US" /><meta name="description" content="Bài viết được tham khảo và ghi chú lại từ series thực hành docker tại Viblo." /><meta property="og:description" content="Bài viết được tham khảo và ghi chú lại từ series thực hành docker tại Viblo." /><link rel="canonical" href="https://demanejar.github.io/posts/Docker/" /><meta property="og:url" content="https://demanejar.github.io/posts/Docker/" /><meta property="og:site_name" content="De Manejar" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-28T20:52:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Docker cơ bản và thực hành" /><meta name="twitter:site" content="@DeManejar" /><meta name="twitter:creator" content="@viethoang" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"viethoang"},"dateModified":"2025-03-17T06:29:35+07:00","datePublished":"2021-07-28T20:52:00+07:00","description":"Bài viết được tham khảo và ghi chú lại từ series thực hành docker tại Viblo.","headline":"Docker cơ bản và thực hành","mainEntityOfPage":{"@type":"WebPage","@id":"https://demanejar.github.io/posts/Docker/"},"url":"https://demanejar.github.io/posts/Docker/"}</script><title>Docker cơ bản và thực hành | De Manejar</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://i.pinimg.com/564x/9c/32/79/9c3279b5ac960533cbcb7e833ac4d947.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">De Manejar</a></div><div class="site-subtitle font-italic">Hello Bigdata !</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/demanejar" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/DeManejar" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['demanejar','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Docker cơ bản và thực hành</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Docker cơ bản và thực hành</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> viethoang </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jul 28, 2021, 8:52 PM +0700" prep="on" > Jul 28, 2021 <i class="unloaded">2021-07-28T20:52:00+07:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Mar 17, 2025, 6:29 AM +0700" prefix="Updated " > Mar 17 <i class="unloaded">2025-03-17T06:29:35+07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3316 words">18 min</span></div></div><div class="post-content"><p>Bài viết được tham khảo và ghi chú lại từ series thực hành docker tại Viblo.</p><p>Link series tại đây: <a href="https://viblo.asia/s/thuc-hanh-docker-tu-can-ban-68Z00n0zZkG">Thực hành Dokcer từ căn bản</a></p><h1 id="i-cài-đặt-docker-và-một-số-khái-niệm-cơ-bản">I. Cài đặt docker và một số khái niệm cơ bản</h1><p>Phần cài đặt có thể tham khảo trên doc</p><h2 id="docker-là-gì">DOCKER LÀ GÌ</h2><h3 id="các-điểm-lợi-từ-khi-ứng-dụng-được-đóng-gói-containerized-app">Các điểm lợi từ khi ứng dụng được đóng gói (containerized app)</h3><ul><li>Build 1 lần dùng mọi nơi ( works on my machine problem solved )<li>Môi trường độc lập<li>Phát triển dễ dàng<li>Tính mở rộng (container orchestration)</ul><blockquote><p>Trước kia có máy ảo cũng có tính chất tương tự thế nhưng tại sao lại có cả docker ? Docker ảo hóa ở mức hệ điều hành còn máy ảo thì ở mức phần cứng</p></blockquote><h3 id="images-và-containers">IMAGES VÀ CONTAINERS</h3><p>Since we already know what containers are it’s easier to explain images through them: Containers are instances of images. A basic mistake is to confuse images and containers.</p><p>Docker images là một file (read-only) không thể thay đổi (thực ra có thể thêm các layers bằng việc bắt đầu từ một base images). Images sẽ được tạo ra bởi việc build một file hướng dẫn (instruction file) gọi là DockerFile.</p><p>Container được tạo ra từ image (read-write). Nó sẽ chứa những thứ cần thiết cho việc chạy chương trình và là một môi trường cô lập trên máy chủ có thể tương tác với các máy khác và chính nó thông qua các giao thức TCP/UDP.</p><p><em>Docker run vs Docker start: The command <code class="language-plaintext highlighter-rouge">docker run</code> is used to only <strong>START</strong> a container for the very first time. To run an existing container what you need is <code class="language-plaintext highlighter-rouge">docker start $container-name</code></em></p><p><em>docker run = create docker container + start docker container</em></p><h1 id="iichia-sẻ-dữ-liệu-host-container-container-container">II.Chia sẻ dữ liệu host-container, container-container</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/demanejar/image-collection/refs/heads/main/Docker/docker_container.jpg" alt="" /></p><p>Chia sẻ dữ liệu tức là các container muốn thao tác hoặc sử dụng tới những dữ liệu trên máy host hay trên các container khác.</p><h2 id="chia-sẻ-dữ-liệu-host-container">Chia sẻ dữ liệu host-container</h2><p>Giả sử ta vừa tạo dữ liệu trên máy host có đường dẫn X</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run <span class="nt">-ti</span> <span class="nt">-v</span> /home/viethoang/petproject:/home/petproject_container ubuntu
</pre></table></code></div></div><p>Giải thích các tham số</p><p>-<code class="language-plaintext highlighter-rouge">ti</code>: cung cấp thao tác và kết nối trên terminal</p><p>-<code class="language-plaintext highlighter-rouge">v</code>: chia sẻ dữ liệu giữa host và container. đường dẫn đầu tiên là của máy host, cái sau dấu : là của container ubuntu là image hệ điều hành ubuntu</p><p>Sau khi chạy lệnh xong ta vào được terminal của container và ta thấy thư mục “petproject” trên máy host ánh xạ với thư mục “petproject_container”. Mọi thay đổi trong thư mục ở host sẽ ảnh hưởng đến container và ngược lại, ví dụ thêm mới hay xóa. Điều đó cũng tương tự khi ở container. Tuy nhiên nếu ta xóa container đi thì dữ liệu trên host vẫn còn.</p><h2 id="chia-sẻ-dữ-liệu-giữa-2-container">Chia sẻ dữ liệu giữa 2 container</h2><p>Bây giờ ta có dữ liệu trên máy host muốn chia sẻ cho cả 2 container. Ta đã có 1 container được chia sẻ từ host với id như hình dưới nên để chia sẻ dữ liệu từ host tới container còn lại ta có thể dùng lệnh:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run <span class="nt">-ti</span> <span class="nt">--name</span> C2 <span class="nt">--volume-from</span> a8232b31eb20 ubuntu 
</pre></table></code></div></div><h2 id="quản-lý-ổ-đĩa-để-chia-sẻ-dữ-liệu-cho-các-container">Quản lý ổ đĩa để chia sẻ dữ liệu cho các container</h2><p>Khi container được tạo ra thì ổ đĩa cũng được tạo và gán vào container đó,khi container bị xóa thì những ổ đĩa vẫn còn ở đó chỉ mất đi khi ta xóa trực tiếp.</p><h3 id="1-tạo-ổ-đĩa">1. Tạo ổ đĩa</h3><p>Lệnh <code class="language-plaintext highlighter-rouge">docker volume ls</code> để xem các ổ đĩa.</p><p>Tạo mới một ổ đĩa tên D1 : <code class="language-plaintext highlighter-rouge">docker volume create D1</code>.</p><h3 id="2-gán-ổ-đĩa-vào-container">2. Gán ổ đĩa vào container</h3><p>Ta thực hiện câu lệnh:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> docker run <span class="nt">-it</span> <span class="nt">--name</span> C3 <span class="nt">--mount</span> <span class="nb">source</span><span class="o">=</span>D1,target<span class="o">=</span>/home/disk ubuntu
</pre></table></code></div></div><p>Tham số <code class="language-plaintext highlighter-rouge">--mount</code> là để gán thêm ổ đĩa khi tạo container</p><p><code class="language-plaintext highlighter-rouge">source=D1</code> là tham số ổ đĩa cần gán vào container</p><p><code class="language-plaintext highlighter-rouge">target=/home/disk</code> với /home/disk là thư mục ánh xạ ổ đĩa D1 vào container</p><h3 id="3-tạo-ổ-đĩa-ánh-xạ-trên-máy-host">3. Tạo ổ đĩa ánh xạ trên máy host</h3><p>Bây giờ ta muốn một ổ đĩa ánh xạ nên một folder cố định có sẵn trên host:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker volume create <span class="nt">--opt</span> <span class="nv">device</span><span class="o">=</span>/home/viethoang/petproject <span class="nt">--opt</span> <span class="nb">type</span><span class="o">=</span>none <span class="nt">--opt</span> <span class="nv">o</span><span class="o">=</span><span class="nb">bind </span>D2
</pre></table></code></div></div><p>Kiểm tra lại:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>~ docker volume inspect D2
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">"CreatedAt"</span>: <span class="s2">"2021-07-28T16:19:19+07:00"</span>,
        <span class="s2">"Driver"</span>: <span class="s2">"local"</span>,
        <span class="s2">"Labels"</span>: <span class="o">{}</span>,
        <span class="s2">"Mountpoint"</span>: <span class="s2">"/var/lib/docker/volumes/D2/_data"</span>,
        <span class="s2">"Name"</span>: <span class="s2">"D2"</span>,
        <span class="s2">"Options"</span>: <span class="o">{</span>
            <span class="s2">"device"</span>: <span class="s2">"/home/viethoang/petproject"</span>,
            <span class="s2">"o"</span>: <span class="s2">"bind"</span>,
            <span class="s2">"type"</span>: <span class="s2">"none"</span>
        <span class="o">}</span>,
        <span class="s2">"Scope"</span>: <span class="s2">"local"</span>
    <span class="o">}</span>
<span class="o">]</span>

</pre></table></code></div></div><ol><li>Tạo container kèm gán ổ đĩa ánh xạ trên local</ol><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run <span class="nt">-it</span> <span class="nt">--name</span> C4 <span class="nt">-v</span> D2:/home/disk ubuntu
</pre></table></code></div></div><p>Container C4 được tạo từ image ubutun có gán ổ đĩa D2 và ổ đĩa được ánh xạ trên 1 folder ở host trong phần trước</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>~ docker <span class="nb">exec</span> <span class="nt">-it</span>  C4 bash
root@976236084a9c:/# <span class="nb">ls</span> /home/disk/
20202  20203  Algorithm-application  DE  Non-Trivial-DE  aia  ktlt
root@976236084a9c:/# 
</pre></table></code></div></div><h1 id="iii-tạo-và-quản-lý-network-trong-docker">III. Tạo và quản lý network trong docker</h1><h2 id="một-số-khái-niệm-và-default-network">Một số khái niệm và default network</h2><h3 id="khái-niệm">Khái niệm</h3><p>Docker network đảm bảo cho các container kết nối vào network:</p><ul><li>các container cùng một network có thể liên lạc với nhau qua tên và cổng mà nó lắng nghe trên mạng đó<li>Kết nối 1 hay nhiều host<li>Kết nối container với các mạng khác nằm ngoài docker<li>Kết nối giữa các cụm container</ul><h3 id="default-network">Default Network</h3><p>Có 3 loại networks được tự động tạo ra trong docker là <strong>bridge, none, host</strong> ta có thể xem bằng lệnh <code class="language-plaintext highlighter-rouge">docker network ls</code>.</p><p><strong>bridge</strong> đây là driver mạng mặc định của Docker, bridge là driver phù hợp nhất cho việc giao tiếp các containers độc lập. các container trong cùng mạng có thể giao tiếp với nhau qua địa chỉ IP, nếu không chỉ định driver thì bridge sẽ là driver mạng mặc định khi khởi tạo.</p><p><strong>none</strong> driver cung cấp cho một container networking stack và không gian mạng riêng của nó, thường được dùng với mạng tùy chỉnh, driver này không thể dùng trong cụm swarm.</p><p><strong>host</strong> dùng khi container cần giao tiếp với host và sử dụng trực tiếp mạng của máy chủ đang chạy.</p><h2 id="tạo-kết-nối-container-với-container">Tạo kết nối container với container</h2><p>Thử tạo 2 container và nằm cùng trên 1 network là bridge để 2 container kết nối được với nhau:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--name</span> B1 busybox<span class="sb">`</span>
</pre></table></code></div></div><p>Sau khi tạo kiểm tra trong mạng bridge đã xuất hiện container B1 chưa:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> docker network inspect bridge
</pre></table></code></div></div><p>Hoặc kiểm tra bằng container:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker inspect B1
</pre></table></code></div></div><p>Sau đó tạo một container B2 tương tự rồi kiểm tra và thử ping từ B1 đến B2:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker attach B1
</pre></table></code></div></div><p>Lệnh trên sẽ vào container B1 và dùng terminal trong đó để ping.</p><h2 id="tạo-kết-nối-giữa-host-và-container">Tạo kết nối giữa host và container</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run <span class="nt">-it</span> <span class="nt">--name</span> B3 <span class="nt">-p</span> 8888:80 busybox
</pre></table></code></div></div><p>-p 8888:80 tức là ánh xạ cổng 8888 trên host với cổng 80 trên container, nghĩa là cổng 8888 trên host sẽ hiển thị được nội dung trên cổng 80 của container.</p><h2 id="tạo-docker-network">Tạo docker network</h2><p>Mục đích là để tạo các mạng tách riêng cho các container có thể sử dụng tách biệt với nhau</p><p>1: Tạo network</p><p><code class="language-plaintext highlighter-rouge">docker network create --driver bridge network1</code></p><p>Lệnh trên tạo ra mạng network1 ta kiểm tra bằng lệnh <code class="language-plaintext highlighter-rouge">docker network ls</code>.</p><p>2: Xóa network</p><p><code class="language-plaintext highlighter-rouge">docker network rm name_network</code></p><p>3: Tạo container kết nối vào một network được chỉ định</p><p><code class="language-plaintext highlighter-rouge">docker run -it --name B4 --network network1 busybox</code></p><p>4: Kêt nối một container đang chạy với một mạng khác</p><p>Ví dụ: ta có 2 network là network1 và network2 có một container B5 đang kết nối với mạng network1 và ta muốn container này kết nối với cả network2 thì ta chạy lệnh.</p><p><code class="language-plaintext highlighter-rouge">docker network connect network2 B5</code></p><p>Lệnh trên là kết nối container B5 vào mạng network2</p><h1 id="iv-dockerfile-build-image-từ-dockerfile">IV. Dockerfile, build image từ dockerfile</h1><h2 id="giới-thiệu-về-dockerfile">Giới thiệu về Dockerfile</h2><p>Dockerfile là một file text có tác dụng chứa các hướng dẫn để docker có thể build image</p><p>Dockerfile = comments + command + arguments</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://openliberty.io/img/blog/blog_optimizing_spring_boot_layers.png" alt="" /></p><p>Docker image được tạo thành từ nhiều layer và mặc định nó bắt đầu từ base layer. Các layer này được tạo ra từ các lệnh (command) trong dockerfile</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.simplilearn.com/ice9/free_resources_article_thumb/layer4.JPG" alt="" /></p><h2 id="cách-viết-dockerfile">Cách viết Dockerfile</h2><h3 id="cú-pháp-của-một-dockerfile">Cú pháp của một Dockerfile</h3><p>Cú pháp chung của một Dockerfile có dạng:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>INSTRUCTION arguments
</pre></table></code></div></div><ul><li><strong>INSTRUCTION</strong> là tên các chỉ thị có trong Dockerfile, mỗi chỉ thị thực hiện một nhiệm vụ nhất định, được Docker quy định. Khi khai báo các chỉ thị này phải được viết bằng chữ IN HOA.<li>Một Dockerfile bắt buộc phải bắt đầu bằng chỉ thị <strong>FROM</strong> để khai báo đâu là image sẽ được sử dụng làm nền để xây dựng nên image của bạn.<li><code class="language-plaintext highlighter-rouge">aguments</code> là phần nội dung của các chỉ thị, quyết định chỉ thị sẽ làm gì.</ul><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>FROM alpine:3.4

RUN apk update <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apk add curl <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apk add git <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apk add vim
</pre></table></code></div></div><h3 id="các-chỉ-thị-chính-trong-dockerfile">Các chỉ thị chính trong Dockerfile</h3><h4 id="from">FROM</h4><p>Chỉ định rằng image nào sẽ được dùng làm image cơ sở để quá trình build image thực thiện các câu lệnh tiếp theo. Các image base này sẽ được tải về từ Public Repository hoặc Private Repository riêng của mỗi người tùy theo setup.</p><p><strong>Cú pháp:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>FROM &lt;image&gt; <span class="o">[</span>AS &lt;name&gt;]
FROM &lt;image&gt;[:&lt;tag&gt;] <span class="o">[</span>AS &lt;name&gt;]
FROM &lt;image&gt;[@&lt;digest&gt;] <span class="o">[</span>AS &lt;name&gt;]
</pre></table></code></div></div><p>Chỉ thị <strong>FROM</strong> là <strong>bắt buộc</strong> và phải được để lên phía trên cùng của Dockerfile.</p><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>FROM ubuntu
hoặc
FROM ubuntu:latest
</pre></table></code></div></div><h4 id="label">LABEL</h4><p>Chỉ thị <strong>LABEL</strong> được dùng để thêm các thông tin meta vào <strong>Docker Image</strong> khi chúng được build. Chúng tồn tại dưới dạng các cặp <em>key</em> - <em>value</em>, được lưu trữ dưới dạng chuỗi. Có thể chỉ định nhiều label cho một Docker Image, và tất nhiên mỗi cặp <em>key</em> - <em>value</em> phải là duy nhất. Nếu cùng một <em>key</em> mà được khai báo nhiều giá trị (value) thì giá trị được khai báo gần đây nhất sẽ ghi đè lên giá trị trước đó.</p><p><strong>Cú pháp:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>LABEL &lt;key&gt;<span class="o">=</span>&lt;value&gt; &lt;key&gt;<span class="o">=</span>&lt;value&gt; &lt;key&gt;<span class="o">=</span>&lt;value&gt; ... &lt;key&gt;<span class="o">=</span>&lt;value&gt; 
</pre></table></code></div></div><p>Bạn có thể khai báo metadata cho Image theo từng dòng chỉ thị hoặc có thể tách ra khai báo thành từng dòng riêng biệt.</p><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>LABEL com.example.some-label<span class="o">=</span><span class="s2">"lorem"</span>
LABEL <span class="nv">version</span><span class="o">=</span><span class="s2">"2.0"</span> <span class="nv">description</span><span class="o">=</span><span class="s2">"Lorem ipsum dolor sit amet, consectetur adipiscing elit."</span>
</pre></table></code></div></div><p>Để xem thông tin meta của một Docker Image, ta sử dụng dòng lệnh:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker inspect &lt;image <span class="nb">id</span><span class="o">&gt;</span>
</pre></table></code></div></div><p><strong>Ví dụ:</strong></p><h4 id="maintainer">MAINTAINER</h4><p>Chỉ thị <strong>MAINTAINER</strong> dùng để khai báo thông tin tác giả người viết ra file Dockerfile.</p><p><strong>Cú pháp:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>MAINTAINER &lt;name&gt; <span class="o">[</span>&lt;email&gt;]
</pre></table></code></div></div><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>MAINTAINER NamDH &lt;namduong3699@gmail.com&gt;
</pre></table></code></div></div><p>Hiện nay, theo tài liệu chính thức từ bên phía <a href="https://docs.docker.com/engine/reference/builder/#maintainer-deprecated">Docker</a> thì việc khai báo <strong>MAINTAINER</strong> đang dần được thay thế bằng <strong>LABEL maintainer</strong> bới tính linh hoạt của nó khi ngoài thông tin về tên, email của tác giả thì ta có thể thêm nhiều thông tin tùy chọn khác qua các thẻ metadata và có thể lấy thông tin dễ dàng với câu lệnh <code class="language-plaintext highlighter-rouge">docker inspect ...</code>.</p><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>LABEL <span class="nv">maintainer</span><span class="o">=</span><span class="s2">"namduong3699@gmail.com"</span>
</pre></table></code></div></div><h4 id="run">RUN</h4><p>Chỉ thị <strong>RUN</strong> dùng để chạy một lệnh nào đó trong quá trình build image và thường là các câu lệnh Linux. Tùy vào image gốc được khai báo trong phần <strong>FROM</strong> thì sẽ có các câu lệnh tương ứng. Ví dụ, để chạy câu lệnh update đối với Ubuntu sẽ là <code class="language-plaintext highlighter-rouge">RUN apt-get update -y</code> còn đối với CentOS thì sẽ là <code class="language-plaintext highlighter-rouge">Run yum update -y</code>. Kết quả của câu lệnh sẽ được commit lại, kết quả commit đó sẽ được sử dụng trong bước tiếp theo của Dockerfile.</p><p><strong>Cú pháp:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>RUN &lt;<span class="nb">command</span><span class="o">&gt;</span>
RUN <span class="o">[</span><span class="s2">"executable"</span>, <span class="s2">"param1"</span>, <span class="s2">"param2"</span><span class="o">]</span>
</pre></table></code></div></div><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>RUN /bin/bash <span class="nt">-c</span> <span class="s1">'source $HOME/.bashrc; echo $HOME'</span>
<span class="nt">--------</span> hoặc <span class="nt">--------</span>
RUN <span class="o">[</span><span class="s2">"/bin/bash"</span>, <span class="s2">"-c"</span>, <span class="s2">"echo hello"</span><span class="o">]</span>
</pre></table></code></div></div><p>Ở cách thức <code class="language-plaintext highlighter-rouge">shell form</code> bạn có thể thực hiện nhiều câu lệnh cùng một lúc với dấu <code class="language-plaintext highlighter-rouge">\</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>FROM ubuntu
RUN apt-get update
RUN apt-get <span class="nb">install </span>curl <span class="nt">-y</span>
</pre></table></code></div></div><p>hoặc</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>FROM ubuntu
RUN apt-get update<span class="p">;</span> <span class="se">\</span>
    apt-get <span class="nb">install </span>curl <span class="nt">-y</span>
</pre></table></code></div></div><h4 id="add">ADD</h4><p>Chỉ thị <strong>ADD</strong> sẽ thực hiện sao chép các tập, thư mục từ máy đang build hoặc remote file URLs từ <code class="language-plaintext highlighter-rouge">src</code> và thêm chúng vào filesystem của image <code class="language-plaintext highlighter-rouge">dest</code>.</p><p><strong>Cú pháp:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>ADD <span class="o">[</span><span class="nt">--chown</span><span class="o">=</span>&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;
ADD <span class="o">[</span><span class="nt">--chown</span><span class="o">=</span>&lt;user&gt;:&lt;group&gt;] <span class="o">[</span><span class="s2">"&lt;src&gt;"</span>,... <span class="s2">"&lt;dest&gt;"</span><span class="o">]</span>
</pre></table></code></div></div><p>Trong đó:</p><ul><li><strong>src</strong> có thể khai báo nhiều file, thư mục, …<li><strong>dest</strong> phải là đường dẫn tuyệt đối hoặc có quan hệ chỉ thị đối với WORKDIR.</ul><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>ADD hom<span class="k">*</span> /mydir/
ADD hom?.txt /mydir/
ADD test.txt relativeDir/
</pre></table></code></div></div><p>Bạn cũng có thể phân quyền vào các file/thư mục mới được copy:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>ADD <span class="nt">--chown</span><span class="o">=</span>55:mygroup files<span class="k">*</span> /somedir/
ADD <span class="nt">--chown</span><span class="o">=</span>bin files<span class="k">*</span> /somedir/
ADD <span class="nt">--chown</span><span class="o">=</span>1 files<span class="k">*</span> /somedir/
ADD <span class="nt">--chown</span><span class="o">=</span>10:11 files<span class="k">*</span> /somedir/
</pre></table></code></div></div><h4 id="copy">COPY</h4><p>Chỉ thị <strong>COPY</strong> cũng giống với <strong>ADD</strong> là copy file, thư mục từ <code class="language-plaintext highlighter-rouge">&lt;src&gt;</code> và thêm chúng vào <code class="language-plaintext highlighter-rouge">&lt;dest&gt;</code> của container. Khác với <strong>ADD</strong>, nó không hỗ trợ thêm các file remote file URLs từ các nguồn trên mạng.</p><p><strong>Cú pháp:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>COPY <span class="o">[</span><span class="nt">--chown</span><span class="o">=</span>&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;
COPY <span class="o">[</span><span class="nt">--chown</span><span class="o">=</span>&lt;user&gt;:&lt;group&gt;] <span class="o">[</span><span class="s2">"&lt;src&gt;"</span>,... <span class="s2">"&lt;dest&gt;"</span><span class="o">]</span>
</pre></table></code></div></div><h4 id="env">ENV</h4><p>Chỉ thị <strong>ENV</strong> dùng để khai báo các biến môi trường. Các biến này được khai báo dưới dạng <em>key</em> - <em>value</em> bằng các chuỗi. Giá trị của các biến này sẽ có hiện hữu cho các chỉ thị tiếp theo của Dockerfile.</p><p><strong>Cú pháp:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ENV &lt;key&gt;<span class="o">=</span>&lt;value&gt; ...
</pre></table></code></div></div><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>ENV <span class="nv">DOMAIN</span><span class="o">=</span><span class="s2">"viblo.asia"</span>
ENV <span class="nv">PORT</span><span class="o">=</span>80
ENV <span class="nv">USERNAME</span><span class="o">=</span><span class="s2">"namdh"</span> <span class="nv">PASSWORD</span><span class="o">=</span><span class="s2">"secret"</span>
</pre></table></code></div></div><p>Ngoài ra cũng có thể thay đổi giá trị của biến môi trường bằng câu lệnh khởi động container:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run <span class="nt">--env</span> &lt;key&gt;<span class="o">=</span>&lt;value&gt;
</pre></table></code></div></div><p><strong>ENV</strong> chỉ được sử dụng trong các command sau:</p><ul><li>ADD<li>COPY<li>ENV<li>EXPOSE<li>FROM<li>LABEL<li>STOPSIGNAL<li>USER<li>VOLUME<li>WORKDIR</ul><h4 id="cmd">CMD</h4><p>Chỉ thị <strong>CMD</strong> định nghĩa các câu lệnh sẽ được chạy sau khi container được khởi động từ image đã build. Có thể khai báo được nhiều nhưng chỉ có duy nhất <strong>CMD</strong> cuối cùng được chạy.</p><p><strong>Cú pháp:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>CMD <span class="o">[</span><span class="s2">"executable"</span>,<span class="s2">"param1"</span>,<span class="s2">"param2"</span><span class="o">]</span>
CMD <span class="o">[</span><span class="s2">"param1"</span>,<span class="s2">"param2"</span><span class="o">]</span> 
CMD <span class="nb">command </span>param1 param2
</pre></table></code></div></div><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>FROM ubuntu
CMD <span class="nb">echo </span>Viblo
</pre></table></code></div></div><h4 id="user">USER</h4><p>Có tác dụng set <code class="language-plaintext highlighter-rouge">username</code> hoặc <code class="language-plaintext highlighter-rouge">UID</code> để sử dụng khi chạy image và khi chạy các lệnh có trong <code class="language-plaintext highlighter-rouge">RUN</code>, <code class="language-plaintext highlighter-rouge">CMD</code>, <code class="language-plaintext highlighter-rouge">ENTRYPOINT</code> sau nó.</p><p><strong>Cú pháp:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>USER &lt;user&gt;[:&lt;group&gt;]
hoặc
USER &lt;UID&gt;[:&lt;GID&gt;]
</pre></table></code></div></div><p><strong>Ví dụ:</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>FROM alpine:3.4
RUN useradd <span class="nt">-ms</span> /bin/bash namdh
USER namdh
</pre></table></code></div></div><h4 id="tạo-image-với-dockerfile">Tạo image với Dockerfile</h4><p>Phần trên mình đã đi qua được cấu trúc cũng như các chỉ thị chính của một Dockerfile. Bây giờ chúng ta sẽ thực hành build một image bằng cách viết một Dockerfile đơn giản. Lưu ý rằng trước khi bắt đầu, hãy chắc chắn rằng máy của bạn đã được cài đặt sẵn <strong>Docker</strong>. Nếu chưa, bạn có thể tham khảo hướng dẫn cài đặt <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-18-04">ở đây</a>.</p><h3 id="tạo-dockerfile">Tạo Dockerfile</h3><h4 id="ví-dụ-1">Ví dụ 1</h4><p>Ở bước này, chúng ta sẽ tạo một đường dẫn mới cho Dockerfile.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir </span>myproject <span class="o">&amp;&amp;</span> <span class="nb">cd </span>myproject
</pre></table></code></div></div><p>Tiếp theo là tạo Dockerfile, lưu ý rằng tên của <code class="language-plaintext highlighter-rouge">Dockerfile</code> phải đúng là “Dockerfile” và không có phần đuôi mở rộng cho loại file này. Nếu không đặt tên đúng, khi build hệ thống sẽ báo lỗi là không tìm thấy file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">touch </span>Dockerfile
</pre></table></code></div></div><p>Sau khi đã tạo xong Dockerfile, ta tiền hành nhập các chỉ thị:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>FROM alpine
CMD <span class="o">[</span><span class="s2">"echo"</span>, <span class="s2">"Hello world!"</span><span class="o">]</span>
</pre></table></code></div></div><p>Như bạn thấy, nội dung của Dockerfile ở trên chỉ chứa 2 chỉ thị <strong>FROM</strong> và <strong>CMD</strong>, CMD chứa câu lệnh <code class="language-plaintext highlighter-rouge">echo</code> và sẽ in ra màn hình dòng chữ “Hello world!” khi mà container được khởi động từ image đã build từ Dockerfile này. Ta tiến hành tạo image với câu lệnh:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker build <span class="nt">-t</span> &lt;tên image&gt; <span class="nb">.</span>
</pre></table></code></div></div><p>Cuối cùng, ta chạy lệnh <code class="language-plaintext highlighter-rouge">docker run &lt;imageID&gt;</code> để tạo và chạy container. Kết quả thu được sẽ là dòng chữ “Hello world!” được in ra trên màn hình.</p><h1 id="v-docker-compose">V. Docker-compose</h1><h2 id="khái-niệm-1">Khái niệm</h2><p>Là công cụ giúp ta thiết lập và quản lý nhiều container, network, volume (gọi chung là các service) và thiết lập cấu hình cho các service một cách nhanh chóng và đơn giản bằng việc chạy theo các chỉ định trong file docker-compose.yml</p><h3 id="những-chức-năng-chính">Những chức năng chính</h3><ul><li>Tạo và quản lý nhiều môi trường độc lập trong một máy host đảm bảo độc lập các phân vùng ổ nhớ tránh say ra xung đột<li>Chỉ tạo lại container thay đổi, nhận biết các container không thay đổi và sử dụng lại<li>Định nghĩa và sử dụng biến môi trường trong file YAML</ul><h3 id="docker-composeyml">Docker-compose.yml</h3><p>Là một file lưu <a href="https://en.wikipedia.org/wiki/YAML">dạng yaml</a>, file này lưu các chỉ thị để docker compose đọc file này và thực thi các chỉ thị đó, các chỉ thị như tạo container từ image, tạo network, cấu hình cho các dịch vụ.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>version: "3.9"  # optional since v1.27.0
services:
  web:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - .:/code
      - logvolume01:/var/log
    links:
      - redis
  redis:
    image: redis
volumes:
  logvolume01: {}
</pre></table></code></div></div><h2 id="thực-hành-docker-compose">Thực hành docker-compose</h2><p>Nhiệm vụ thực hành của chúng ta là định nghĩa docker file để tạo ra các thành phần sau</p><ul><li>Container MySQL<li>Container HTTP APACHE<li>Container PHP-FPM<li>Network (bridge) để các service trên kết nối vào mạng này<li>Ánh xạ cổng 9999 của máy host vào cổng 80 của máy chủ HTTP</ul><h3 id="tạo-docker-composeyml">Tạo docker-compose.yml</h3><p>Tạo thư mục mycode bên trong ta tạo file docker-compose.yml với nội dung như sau (mình có comment giải thích trong phần nội dung file).</p><div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span> <span class="c1">#là phiên bản docker composer</span>

<span class="c1">#Tạo mạng tên là my-network</span>
<span class="na">networks</span><span class="pi">:</span>
    <span class="na">my-network</span><span class="pi">:</span>
        <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>

<span class="c1"># Tạo các dịch vụ (container)</span>
<span class="na">services</span><span class="pi">:</span>

    <span class="c1">#Tạo container my-php từ imgae php:latest có kết nối với mạng my-network</span>
    <span class="na">my-php</span><span class="pi">:</span>
        <span class="na">container_name</span><span class="pi">:</span> <span class="s">php-product</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s1">'</span><span class="s">php:latest'</span>
        <span class="na">hostname</span><span class="pi">:</span> <span class="s">php</span>
        <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
        <span class="na">networks</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">my-network</span>

    <span class="c1">#Tạo container my-httpd từ imgae httpd:latest có kết nối với mạng my-network, ánh xạ cổng 9999 của máy host vào cổng 80</span>
    <span class="na">my-httpd</span><span class="pi">:</span>
        <span class="na">container_name</span><span class="pi">:</span> <span class="s">c-httpd01</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s1">'</span><span class="s">httpd:latest'</span>
        <span class="na">hostname</span><span class="pi">:</span> <span class="s">httpd</span>
        <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
        <span class="na">networks</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">my-network</span>
        <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s2">"</span><span class="s">9999:80"</span>
            <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
            
     <span class="c1">#Tạo container my-mysql từ imgae mysql:latest có kết nối với mạng my-network,config các biến môi trường</span>
    <span class="na">my-mysql</span><span class="pi">:</span>
        <span class="na">container_name</span><span class="pi">:</span> <span class="s">myql-product</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mysql:latest"</span>
        <span class="na">hostname</span><span class="pi">:</span> <span class="s">mysql</span>
        <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
        <span class="na">networks</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">my-network</span>
        <span class="na">environment</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">MYSQL_ROOT_PASSWORD=123abc</span>
            <span class="pi">-</span> <span class="s">MYSQL_DATABASE=db_site</span>
            <span class="pi">-</span> <span class="s">MYSQL_USER=sites</span>
            <span class="pi">-</span> <span class="s">MYSQL_PASSWORD=123abc</span>
</pre></table></code></div></div><p>File trên được chia làm 3 phần</p><ul><li><p>phần đầu là khai báo phiên bản docker composer, ở đây mình dùng phiên bản 3</p><li>Phần tiếp theo là khai báo tạo các mạng, ở đây mình tạo một mạng tên là my-network kiểu mạng là bridge<li><p>Phần tiếp theo là tạo các services, ở đây là tạo 3 services là 3 container (php, httpd, mysql), các service này đều kết nối đến mạng my-network đã tạo trên phần 2</p><ul><li>Container my-php tạo từ imgae php:latest có kết nối với mạng my-network<li>Container my-httpd tạo từ imgae httpd:latest có kết nối với mạng my-network, ánh xạ cổng 9999 của máy host vào cổng 80 và cổng 443 với 443 máy host<li>Container my-mysql tạo từ imgae mysql:latest có kết nối với mạng my-network,config các biến môi trường như MYSQL_ROOT_PASSWORD, MYSQL_DATABASE,MYSQL_USER, MYSQL_PASSWORD</ul></ul><h3 id="run-file-docker-composeyml-tạo-các-service">Run file docker-compose.yml tạo các service</h3><p>Tạo xong file docker compose, giờ chúng ta sẽ run file này để tạo ra các service đã định nghĩa.</p><p>Ta vào thư mục chứa file docker-compose.yml và chạy lệnh</p><p><code class="language-plaintext highlighter-rouge">docker-compose up</code></p><p>Muốn dừng các services đang chạy thì ta dùng lệnh</p><p><code class="language-plaintext highlighter-rouge">docker-compose stop</code></p><p>Để kết thúc các services đang chạy và xóa hoàn toàn container ta dùng lệnh</p><p><code class="language-plaintext highlighter-rouge">docker-compose down</code></p><p>Theo dõi Logs các services</p><p><code class="language-plaintext highlighter-rouge">docker-compose logs [SERVICES]</code></p><h1 id="vi-docker-swarm">VI. Docker swarm</h1><h1 id="vii-tham-khảo">VII. Tham Khảo</h1><p>Các nguồn tham khảo khác:</p><p><a href="https://viblo.asia/p/tim-hieu-ve-dockerfile-va-tao-docker-image-V3m5WWag5O7#_cu-phap-cua-mot-dockerfile-1">Tìm hiểu về Dockerfile và tạo Docker Image</a></p><p><a href="https://www.youtube.com/watch?v=tb4eDxdJscg&amp;ab_channel=Simplilearn">Dockerfile tutorial</a></p><p><a href="https://devopswithdocker.com/">Devops with Docker</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/docker/" class="post-tag no-text-decoration" >Docker</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Docker cơ bản và thực hành - De Manejar&url=https://demanejar.github.io/posts/Docker/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Docker cơ bản và thực hành - De Manejar&u=https://demanejar.github.io/posts/Docker/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Docker cơ bản và thực hành - De Manejar&url=https://demanejar.github.io/posts/Docker/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/k8s/">Tìm hiểu tổng quan k8s</a><li><a href="/posts/add-proxy-to-scrapy-project/">Cấu hình proxy cho project Scrapy</a><li><a href="/posts/crawl-1000-website-new-with-scrapy/">Crawl 1000 trang báo với Scrapy và MySQL</a><li><a href="/posts/php-scraper/">PHP Scraper</a><li><a href="/posts/scrapy-shell/">Giới thiệu Scrapy Shell</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/bigdata/">Bigdata</a> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/crawler/">Crawler</a> <a class="post-tag" href="/tags/hdfs/">HDFS</a> <a class="post-tag" href="/tags/scrapy/">Scrapy</a> <a class="post-tag" href="/tags/hadoop/">Hadoop</a> <a class="post-tag" href="/tags/apache-hadoop/">Apache Hadoop</a> <a class="post-tag" href="/tags/ubuntu/">Ubuntu</a> <a class="post-tag" href="/tags/spark-sql/">Spark SQL</a> <a class="post-tag" href="/tags/alonhadat/">alonhadat</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/redis-101-(part-1)/"><div class="card-body"> <span class="timeago small" > Jun 10, 2021 <i class="unloaded">2021-06-10T20:52:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Redis 101 (Part I)</h3><div class="text-muted small"><p> Tổng quan Trong thời gian học môn Lưu trữ và xử lý dữ liệu lớn ở trường, mình có được nghe qua về redis. Đây là một cơ sở dữ liệu dạng NoSQL. Khác với các cơ sở dữ liệu khác thì đây là một dạng lư...</p></div></div></a></div><div class="card"> <a href="/posts/airflow-ha/"><div class="card-body"> <span class="timeago small" > Feb 18, 2024 <i class="unloaded">2024-02-18T20:52:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hướng dẫn Airflow HA</h3><div class="text-muted small"><p> Trong bài này mình sẽ hướng dẫn cài đặt Airflow và cài HA cho nó. môi trường sử dụng là máy ảo virtualbox tạo 2 máy ảo với địa chỉ cố định, add user và cập quyền ssh từ host 1 2 3 4 5 6 7 8 ...</p></div></div></a></div><div class="card"> <a href="/posts/Kafka-In-Depth/"><div class="card-body"> <span class="timeago small" > Jul 8, 2021 <i class="unloaded">2021-07-08T20:52:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kafka In Depth</h3><div class="text-muted small"><p> Trong quá trình làm bài tập lớn môn lưu trữ và xử lý dữ liệu lớn ở trường mình có biết đến kafka và sử dụng cho project của mình. Tuy nhiên lúc đó mình mới chỉ biết đơn giản nó là một message queue...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Apache-Nifi/" class="btn btn-outline-primary" prompt="Older"><p>Tìm hiểu về Apache Nifi</p></a> <a href="/posts/hadoop-mapreduce-and-wordcount-project/" class="btn btn-outline-primary" prompt="Newer"><p>Hadoop MapReduce và chương trình WordCount cơ bản với MapReduce</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/DeManejar">demanejar</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div><script type="text/javascript"> var links = document.links; for (var i = 0, linksLength = links.length; i < linksLength; i++) { if (links[i].hostname != window.location.hostname) { links[i].target = '_blank'; } } </script></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/bigdata/">Bigdata</a> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/crawler/">Crawler</a> <a class="post-tag" href="/tags/hdfs/">HDFS</a> <a class="post-tag" href="/tags/scrapy/">Scrapy</a> <a class="post-tag" href="/tags/hadoop/">Hadoop</a> <a class="post-tag" href="/tags/apache-hadoop/">Apache Hadoop</a> <a class="post-tag" href="/tags/ubuntu/">Ubuntu</a> <a class="post-tag" href="/tags/spark-sql/">Spark SQL</a> <a class="post-tag" href="/tags/alonhadat/">alonhadat</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://demanejar.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
