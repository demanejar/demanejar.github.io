<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property="og:image" content="https://raw.githubusercontent.com/demanejar/image-collection/refs/heads/main/SparkSQL/5064132e69821108d0c4fff3c6afd9ce.jpg"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-9TR0K3B846"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8714452693053438" crossorigin="anonymous"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-9TR0K3B846'); </script><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Spark SQL, Dataframe và Dataset" /><meta name="author" content="trannguyenhan" /><meta property="og:locale" content="en_US" /><meta name="description" content="Spark SQL là một mô hình để xử lý dữ liệu có cấu trúc của Spark rất phổ biến. Interfaces cung cấp bởi Spark SQL có thêm các thông tin về cấu trúc của dữ liệu và các tính toán đang được thực hiện. Với những thông tin bổ sung này Spark SQL có thể thực hiện các tối ưu hóa bổ sung" /><meta property="og:description" content="Spark SQL là một mô hình để xử lý dữ liệu có cấu trúc của Spark rất phổ biến. Interfaces cung cấp bởi Spark SQL có thêm các thông tin về cấu trúc của dữ liệu và các tính toán đang được thực hiện. Với những thông tin bổ sung này Spark SQL có thể thực hiện các tối ưu hóa bổ sung" /><link rel="canonical" href="https://demanejar.github.io/posts/spark-sql-dataframe-dataset/" /><meta property="og:url" content="https://demanejar.github.io/posts/spark-sql-dataframe-dataset/" /><meta property="og:site_name" content="De Manejar" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-26T20:52:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spark SQL, Dataframe và Dataset" /><meta name="twitter:site" content="@DeManejar" /><meta name="twitter:creator" content="@trannguyenhan" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"trannguyenhan"},"dateModified":"2025-03-17T06:29:35+07:00","datePublished":"2021-08-26T20:52:00+07:00","description":"Spark SQL là một mô hình để xử lý dữ liệu có cấu trúc của Spark rất phổ biến. Interfaces cung cấp bởi Spark SQL có thêm các thông tin về cấu trúc của dữ liệu và các tính toán đang được thực hiện. Với những thông tin bổ sung này Spark SQL có thể thực hiện các tối ưu hóa bổ sung","headline":"Spark SQL, Dataframe và Dataset","mainEntityOfPage":{"@type":"WebPage","@id":"https://demanejar.github.io/posts/spark-sql-dataframe-dataset/"},"url":"https://demanejar.github.io/posts/spark-sql-dataframe-dataset/"}</script><title>Spark SQL, Dataframe và Dataset | De Manejar</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://i.pinimg.com/564x/9c/32/79/9c3279b5ac960533cbcb7e833ac4d947.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">De Manejar</a></div><div class="site-subtitle font-italic">Hello Bigdata !</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/demanejar" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/DeManejar" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['demanejar','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Spark SQL, Dataframe và Dataset</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spark SQL, Dataframe và Dataset</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> trannguyenhan </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 26, 2021, 8:52 PM +0700" prep="on" > Aug 26, 2021 <i class="unloaded">2021-08-26T20:52:00+07:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Mar 17, 2025, 6:29 AM +0700" prefix="Updated " > Mar 17 <i class="unloaded">2025-03-17T06:29:35+07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1803 words">10 min</span></div></div><div class="post-content"><p><em>Spark SQL là một mô hình để xử lý dữ liệu có cấu trúc của Spark rất phổ biến. Interfaces cung cấp bởi Spark SQL có thêm các thông tin về cấu trúc của dữ liệu và các tính toán đang được thực hiện. Với những thông tin bổ sung này Spark SQL có thể thực hiện các tối ưu hóa bổ sung</em></p><h2 id="sql">SQL</h2><p>Spark SQL được thiết kế cực kì gần gũi với các hệ quản trị cơ sở dữ liệu có quan hệ, nhưng không phải về mặt kiến trúc bên trong mà là về mặt tương tác với dữ liệu từ bên ngoài.</p><p>Chúng ta có thể truy vấn dữ dữ liệu bằng những câu truy vấn SQL cực kì quen thuộc trong MySQL hay MS SQL Server. Khi đi sâu vào ví dụ mình sẽ giải thích kĩ hơn phần này để mọi người có thể thấy rõ ràng Spark SQL dễ sử dụng như nào khi bạn là master bộ môn cơ sở dữ liệu tại trường.</p><h2 id="dataframe-và-dataset">Dataframe và Dataset</h2><p><strong>Dataframe</strong> là tập dữ liệu phân tán, có cấu trúc là một tập dữ liệu 2 chiều, hay chúng ta có thể hiểu đơn giản nó là một cái bảng tính hay là bảng trong SQL (nhưng phải là một bảng được tối ưu hóa tốt).</p><p><strong>Dataset</strong> thì rộng hơn dataframe, chúng ta có thể nhìn vào ngôn ngữ Java để dễ hiểu hơn, khi khai báo trong Java dataframe được khai báo là <code class="language-plaintext highlighter-rouge">Dataset&lt;Row&gt;</code>, vậy ta hiểu đơn giản dataframe như là dataset của các hàng, còn ngoài ra dataset có thể chứa thêm nhiều kiểu dữ liệu nữa như là <code class="language-plaintext highlighter-rouge">Dataset&lt;String&gt;</code>, <code class="language-plaintext highlighter-rouge">Dataset&lt;Integer&gt;</code>. Dataset còn có thể chứa một đối tượng bất kì mà chúng ta định nghĩa ra nữa.</p><p>Trong bài viết này hay là sau có làm bài tập nếu có nhắc tới <code class="language-plaintext highlighter-rouge">Dataframe</code> thì chúng ta hãy hiểu ngầm rằng đó chính là <code class="language-plaintext highlighter-rouge">Dataset&lt;Row&gt;</code> và ngược lại nha.</p><p>Giống với RDD, Dataset cũng có các phép biến đổi như <code class="language-plaintext highlighter-rouge">map</code>, <code class="language-plaintext highlighter-rouge">flatmap</code>, <code class="language-plaintext highlighter-rouge">filter</code>,…</p><p><strong>Riêng ý kiến của mình về việc sử dụng ngôn ngữ nào thì mình cho rằng</strong>, mặc dù khi sử dụng Java bạn sẽ phải viết code dài hơn các ngôn ngữ khác như Scala hay Python. Tuy nhiên bạn sẽ hiểu được chi tiết từng câu lệnh mà bạn viết ra, thậm chí sau 1-2 tháng bạn đọc lại bạn vẫn có thể hình dung ra code của bạn đang viết gì vì Java viết code rất có quy tắc, các kiểu dữ liệu đều được khai báo, định nghĩa rõ ràng. Tất nhiên là mỗi người thì có một cách nhìn khác nhau và lựa chọn của riêng mình, và dù là sử dụng ngôn ngữ nào trong Spark đi nữa thì về cơ bản đều giống nhau mà thôi, mỗi bước trong ngôn ngữ này hoàn toàn có thể chuyển qua mỗi bước trong ngôn ngữ khác.</p><h2 id="spark-dataframes-operations">Spark DataFrames Operations</h2><p>Dĩ nhiên dataframe là chúng ta sẽ sử dụng chủ yếu vì thế nên đôi lúc dataframe sẽ chiếm nhiều phần hơn trong bài viết này của mình. Dataset như là một phần mở rộng của dataframe tuy nhiên nó được sử dụng như là trung gian để chuyển đổi mà thôi.</p><h3 id="read">read</h3><p>Spark SQL có thể đọc được dữ liệu từ rất nhiều loại file như là csv, json, parquet,… bằng cách sử dụng hàm <code class="language-plaintext highlighter-rouge">read()</code>. Ví dụ:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"resources/input.csv"</span><span class="o">);</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">json</span><span class="o">(</span><span class="s">"resources/input.json"</span><span class="o">);</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">parquet</span><span class="o">(</span><span class="s">"resources/input.parquet"</span><span class="o">);</span>
</pre></table></code></div></div><p>Ngoài ra bạn có thể thêm một số option để có thể đọc dữ liệu theo ý muốn ví dụ như để tự động nhận schema khi đọc vào file csv thì sử dụng:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">option</span><span class="o">(</span><span class="s">"inferSchema"</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="na">csv</span><span class="o">(</span><span class="s">"resources/input.csv"</span><span class="o">);</span>
</pre></table></code></div></div><p>Hoặc để Spark hiểu hàng đầu tiên của file csv là hàng tiêu đề thì thêm vào option:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">option</span><span class="o">(</span><span class="s">"header"</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="na">csv</span><span class="o">(</span><span class="s">"resources/input.csv"</span><span class="o">);</span>
</pre></table></code></div></div><h3 id="write">write</h3><p>Về ý nghĩa thì hàm write sẽ giúp ghi dữ liệu ra một file đầu ra và việc sử dụng hoàn toàn giống với hàm read chỉ thay <code class="language-plaintext highlighter-rouge">read()</code> bằng <code class="language-plaintext highlighter-rouge">write()</code> trong các câu lệnh.</p><h3 id="show">show</h3><p>Để nhìn hoặc kiểm tra dữ liệu trong 1 dataframe thì sử dụng hàm <code class="language-plaintext highlighter-rouge">show()</code>, mục đích chính chỉ nhằm kiểm tra mà thôi nên <code class="language-plaintext highlighter-rouge">show()</code> chỉ hỗ trợ in ra 20 hàng trong dataframe.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"resources/input.csv"</span><span class="o">);</span>
<span class="n">data</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>
</pre></table></code></div></div><p>Kết quả cho ra giống như bên dưới đây:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>+--------+------+---+------------+
|Employee|Salary|stt|Salary_count|
+--------+------+---+------------+
|  George|    80| 10|          10|
|   Steve|    65|  9|          10|
|   Nigel|    64|  8|          10|
|   Micky|    62|  7|          10|
|     Lee|    60|  6|          10|
|    Tony|    50|  5|          10|
|    Paul|    48|  4|          10|
|    Alan|    45|  3|          10|
|    John|    42|  2|          10|
|   David|    35|  1|          10|
+--------+------+---+------------+
</pre></table></code></div></div><p>(Ví dụ này mình sẽ lấy để làm tập dữ liệu cho một số ví dụ bên dưới nha)</p><h3 id="printschema">printSchema</h3><p><code class="language-plaintext highlighter-rouge">printSchema</code> in ra cấu trúc của bảng hay là kiểu dữ liệu của từng cột.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"resources/input.csv"</span><span class="o">);</span>
<span class="n">data</span><span class="o">.</span><span class="na">printSchema</span><span class="o">();</span>
</pre></table></code></div></div><p>Kết quả cho ra sẽ giống như bên dưới đây:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>root
 |-- Employee: string <span class="o">(</span>nullable <span class="o">=</span> <span class="nb">true</span><span class="o">)</span>
 |-- Salary: integer <span class="o">(</span>nullable <span class="o">=</span> <span class="nb">true</span><span class="o">)</span>
 |-- stt: integer <span class="o">(</span>nullable <span class="o">=</span> <span class="nb">true</span><span class="o">)</span>
 |-- Salary_count: long <span class="o">(</span>nullable <span class="o">=</span> <span class="nb">false</span><span class="o">)</span>
</pre></table></code></div></div><h3 id="select">select</h3><p><code class="language-plaintext highlighter-rouge">select</code> giúp lấy ra các cột theo ý muốn khi mà chúng ta không muốn in hết toàn bộ dữ liệu của dataframe.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"resources/input.csv"</span><span class="o">);</span>
<span class="n">data</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"Employee"</span><span class="o">,</span> <span class="s">"Salary"</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</pre></table></code></div></div><p>Ví dụ trên lấy ra và hiển thị 2 hàng “Employee” và “Salary”, kết quả sẽ cho ra giống như bên dưới đây:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>+--------+------+
|Employee|Salary|
+--------+------+
|  George|    80|
|   Steve|    65|
|   Nigel|    64|
|   Micky|    62|
|     Lee|    60|
|    Tony|    50|
|    Paul|    48|
|    Alan|    45|
|    John|    42|
|   David|    35|
+--------+------+
</pre></table></code></div></div><h3 id="filter">filter</h3><p>Giống với <code class="language-plaintext highlighter-rouge">select</code> tuy nhiên ta có thể hiểu là <code class="language-plaintext highlighter-rouge">select</code> là lọc cột còn <code class="language-plaintext highlighter-rouge">filter</code> là lọc hàng.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"resources/input.csv"</span><span class="o">);</span>
<span class="n">data</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">col</span><span class="o">(</span><span class="s">"Salary"</span><span class="o">).</span><span class="n">$greater</span><span class="o">(</span><span class="mi">60</span><span class="o">)).</span><span class="na">show</span><span class="o">();</span>
</pre></table></code></div></div><p>Ví dụ trên lọc ra các hàng mà có cột “Salary” có giá trị lớn hơn 60, kết quả cho ra sẽ giống như bên dưới đây:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>+--------+------+---+------------+
|Employee|Salary|stt|Salary_count|
+--------+------+---+------------+
|  George|    80| 10|          10|
|   Steve|    65|  9|          10|
|   Nigel|    64|  8|          10|
|   Micky|    62|  7|          10|
+--------+------+---+------------+
</pre></table></code></div></div><h3 id="groupby">groupBy</h3><p><code class="language-plaintext highlighter-rouge">groupBy</code> sẽ giúp nhóm lại các hàng mà có cùng giá trị cần nhóm và có thể thực hiện tính toán trên các giá trị mà chúng ta nhóm lại.</p><p>Bây giờ chúng ta sẽ tạo ra 1 tập dữ liệu khác để dễ minh họa hơn:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"integer"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"day"</span><span class="o">,</span> <span class="s">"integer"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"price"</span><span class="o">,</span> <span class="s">"integer"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"units"</span><span class="o">,</span> <span class="s">"integer"</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">listOfdata</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;();</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">23</span><span class="o">,</span><span class="mi">10</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">45</span><span class="o">,</span><span class="mi">11</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">67</span><span class="o">,</span><span class="mi">12</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">78</span><span class="o">,</span><span class="mi">13</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">101</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">23</span><span class="o">,</span><span class="mi">10</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">101</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">45</span><span class="o">,</span><span class="mi">13</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">101</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">67</span><span class="o">,</span><span class="mi">14</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">101</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">78</span><span class="o">,</span><span class="mi">15</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">102</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">23</span><span class="o">,</span><span class="mi">10</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">102</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">45</span><span class="o">,</span><span class="mi">11</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">102</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">67</span><span class="o">,</span><span class="mi">16</span><span class="o">));</span>
<span class="n">listOfdata</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">102</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">78</span><span class="o">,</span><span class="mi">18</span><span class="o">));</span>
</pre></table></code></div></div><p>Kết quả sau khi tạo tập dữ liệu trên là một bảng như sau:</p><div class="table-wrapper"><table><thead><tr><th>id<th>day<th>price<th>units<tbody><tr><td>100<td>1<td>23<td>10<tr><td>100<td>2<td>45<td>11<tr><td>100<td>3<td>67<td>12<tr><td>100<td>4<td>78<td>13<tr><td>101<td>1<td>23<td>10<tr><td>101<td>2<td>45<td>13<tr><td>101<td>3<td>67<td>14<tr><td>101<td>4<td>78<td>15<tr><td>102<td>1<td>23<td>10<tr><td>102<td>2<td>45<td>11<tr><td>102<td>3<td>67<td>16<tr><td>102<td>4<td>78<td>18</table></div><p>Nhiệm vụ của chúng ta bây giờ là nhóm lại các hàng có id giống nhau sử dụng groupBy như sau:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">data</span><span class="o">.</span><span class="na">groupBy</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">agg</span><span class="o">(</span><span class="n">functions</span><span class="o">.</span><span class="na">collect_list</span><span class="o">(</span><span class="s">"price"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"prices"</span><span class="o">),</span> <span class="n">functions</span><span class="o">.</span><span class="na">collect_list</span><span class="o">(</span><span class="s">"units"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"units"</span><span class="o">)).</span><span class="na">show</span><span class="o">();</span>
</pre></table></code></div></div><p>Kết quả sau khi thực hiện là:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>+---+----------------+----------------+
| <span class="nb">id</span>|          prices|           units|
+---+----------------+----------------+
|101|[23, 45, 67, 78]|[10, 13, 14, 15]|
|100|[23, 45, 67, 78]|[10, 11, 12, 13]|
|102|[23, 45, 67, 78]|[10, 11, 16, 18]|
+---+----------------+----------------+
</pre></table></code></div></div><p>Chúng ta cũng có thể thực hiện tính tổng hay tính trung bình, tìm min, tìm max bằng cách thay collect_list bằng sum, min, max,… như dưới đây:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">data</span><span class="o">.</span><span class="na">groupBy</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">agg</span><span class="o">(</span><span class="n">functions</span><span class="o">.</span><span class="na">sum</span><span class="o">(</span><span class="s">"price"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"prices"</span><span class="o">),</span> <span class="n">functions</span><span class="o">.</span><span class="na">sum</span><span class="o">(</span><span class="s">"units"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"units"</span><span class="o">)).</span><span class="na">show</span><span class="o">();</span>
</pre></table></code></div></div><p>Kết quả cho ra là:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>+---+------+-----+
| <span class="nb">id</span>|prices|units|
+---+------+-----+
|101|   213|   52|
|100|   213|   46|
|102|   213|   55|
+---+------+-----+
</pre></table></code></div></div><h2 id="truy-vấn-bằng-các-câu-lệnh-sql">Truy vấn bằng các câu lệnh SQL</h2><p>Việc sử dụng các câu lệnh SQL sẽ là dễ sử dụng hơn, dễ hiểu hơn và gần gũi hơn rất nhiều so với chúng ta. Và vì thế nên mình thấy kể cả học hay đi làm thì việc sử dụng SQL để truy vấn dữ liệu là được sử dụng nhiều hơn khi mình sử dụng các hàm được cung cấp cho các dataframe.</p><p>Ví dụ chúng ta cũng sẽ đi thực hiện tính tổng giống như ví dụ bên trên:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">data</span><span class="o">.</span><span class="na">createOrReplaceTempView</span><span class="o">(</span><span class="s">"data"</span><span class="o">);</span>
<span class="n">spark</span><span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"select id, sum(price) as prices, sum(units) as units from data group by id"</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">data.createOrReplaceTempView("data");</code> sẽ giúp tạo ra 1 bảng giống với trong các cơ sở dữ liệu quan hệ và chúng ta sẽ thao tác trên đó.</p><p>Kết quả của ví dụ này thu được cũng giống như kết quả của ví dụ bên trên.</p><p>Những gì mà bạn làm được trong SQL như join, inner join, group by, select,… các bạn đề có thể làm y hệt với Spark SQL, cách viết cũng là y hệt. Mọi thứ là quá quen thuộc với những câu truy vấn SQL thế nên phần này mình sẽ dừng lại ở đây.</p><h2 id="chuyển-đổi-từ-datasetrow-sang-datasetstring">Chuyển đổi từ <code class="language-plaintext highlighter-rouge">Dataset&lt;Row&gt;</code> Sang <code class="language-plaintext highlighter-rouge">Dataset&lt;String&gt;</code></h2><p>Như phần đầu thì mình có nói là chúng ta có thể chuyển sang bất kì loại <code class="language-plaintext highlighter-rouge">Dataset</code> nào từ <code class="language-plaintext highlighter-rouge">Dataset&lt;Row&gt;</code> kể cả các object mà các bạn tự định nghĩa. Trong phần này mình nói về việc chuyển từ Dataset<Row> Sang `Dataset<String>` để có thể dễ dàng hình dung hơn.</String></Row></p><p>Chúng ta sẽ sử dụng lại tập dữ liệu bên trên:</p><div class="table-wrapper"><table><thead><tr><th>Employee<th>Salary<th>stt<th>Salary_count<tbody><tr><td>George<td>80<td>10<td>10<tr><td>Steve<td>65<td>9<td>10<tr><td>Nigel<td>64<td>8<td>10<tr><td>Micky<td>62<td>7<td>10<tr><td>Lee<td>60<td>6<td>10<tr><td>Tony<td>50<td>5<td>10<tr><td>Paul<td>48<td>4<td>10<tr><td>Alan<td>45<td>3<td>10<tr><td>John<td>42<td>2<td>10<tr><td>David<td>35<td>1<td>10</table></div><p>Bây giờ mình sẽ nhóm lại tập dữ liệu trên thành một thông tin dạng <code class="language-plaintext highlighter-rouge">[Employee] : [Salary]</code> như sau:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">data</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="nc">MapFunction</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;()</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">call</span><span class="o">(</span><span class="nc">Row</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="s">" : "</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">},</span> <span class="nc">Encoders</span><span class="o">.</span><span class="na">STRING</span><span class="o">()).</span><span class="na">show</span><span class="o">();</span>
</pre></table></code></div></div><p>Kết quả thu được là:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>+-----------+
|      value|
+-----------+
|George : 80|
| Steve : 65|
| Nigel : 64|
| Micky : 62|
|   Lee : 60|
|  Tony : 50|
|  Paul : 48|
|  Alan : 45|
|  John : 42|
| David : 35|
+-----------+
</pre></table></code></div></div><p>Tham khảo: <a href="https://spark.apache.org/docs/2.3.0/sql-programming-guide.html">https://spark.apache.org/</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hadoop-spark/'>Hadoop & Spark</a>, <a href='/categories/spark/'>Spark</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spark-sql/" class="post-tag no-text-decoration" >Spark SQL</a> <a href="/tags/bigdata/" class="post-tag no-text-decoration" >Bigdata</a> <a href="/tags/spark/" class="post-tag no-text-decoration" >Spark</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spark SQL, Dataframe và Dataset - De Manejar&url=https://demanejar.github.io/posts/spark-sql-dataframe-dataset/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spark SQL, Dataframe và Dataset - De Manejar&u=https://demanejar.github.io/posts/spark-sql-dataframe-dataset/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Spark SQL, Dataframe và Dataset - De Manejar&url=https://demanejar.github.io/posts/spark-sql-dataframe-dataset/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/k8s/">Tìm hiểu tổng quan k8s</a><li><a href="/posts/add-proxy-to-scrapy-project/">Cấu hình proxy cho project Scrapy</a><li><a href="/posts/crawl-1000-website-new-with-scrapy/">Crawl 1000 trang báo với Scrapy và MySQL</a><li><a href="/posts/php-scraper/">PHP Scraper</a><li><a href="/posts/scrapy-shell/">Giới thiệu Scrapy Shell</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/bigdata/">Bigdata</a> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/crawler/">Crawler</a> <a class="post-tag" href="/tags/hdfs/">HDFS</a> <a class="post-tag" href="/tags/scrapy/">Scrapy</a> <a class="post-tag" href="/tags/hadoop/">Hadoop</a> <a class="post-tag" href="/tags/apache-hadoop/">Apache Hadoop</a> <a class="post-tag" href="/tags/ubuntu/">Ubuntu</a> <a class="post-tag" href="/tags/spark-sql/">Spark SQL</a> <a class="post-tag" href="/tags/alonhadat/">alonhadat</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/retail-data-analytics-with-spark-sql/"><div class="card-body"> <span class="timeago small" > Sep 2, 2021 <i class="unloaded">2021-09-02T20:52:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Phân tích dữ liệu bán lẻ với Spark SQL</h3><div class="text-muted small"><p> Như đã tìm hiểu ở bài viết trước về Spark SQL, Dataframe và Dataset, Spark SQL là một mô hình để xử lý dữ liệu có cấu trúc của Spark rất phổ biến. Trong bài viết này chúng ta sẽ sử dụng Spark SQL đ...</p></div></div></a></div><div class="card"> <a href="/posts/spark-sql-window-function-pivot/"><div class="card-body"> <span class="timeago small" > Sep 9, 2021 <i class="unloaded">2021-09-09T08:52:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Window function, pivot trong Spark SQL</h3><div class="text-muted small"><p> Window aggregate functions (hay thường được gọi tắt là window functions hoặc windowed aggregates) là hàm giúp hỗ trợ tính toán trên 1 nhóm các bản ghi được gọi là cửa sổ mà có liên quan tới bản ghi...</p></div></div></a></div><div class="card"> <a href="/posts/spark-sql-window-function-pivot-part-2/"><div class="card-body"> <span class="timeago small" > Sep 14, 2021 <i class="unloaded">2021-09-14T08:52:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Window function, pivot trong Spark SQL (Part 2)</h3><div class="text-muted small"><p> Nếu bạn chưa xem phần 1 thì có thể xem lại TẠI ĐÂY nha, bài viết hôm nay mình sẽ giới thiệu tiếp tới mọi người một số ví dụ về window function và pivot sâu hơn để mọi người có thể hiểu rõ hơn về wi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/word-count-with-spark-submit-and-spark-shell/" class="btn btn-outline-primary" prompt="Older"><p>Chương trình Word Count với spark-submit và spark-shell</p></a> <a href="/posts/retail-data-analytics-with-spark-sql/" class="btn btn-outline-primary" prompt="Newer"><p>Phân tích dữ liệu bán lẻ với Spark SQL</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/DeManejar">demanejar</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div><script type="text/javascript"> var links = document.links; for (var i = 0, linksLength = links.length; i < linksLength; i++) { if (links[i].hostname != window.location.hostname) { links[i].target = '_blank'; } } </script></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/bigdata/">Bigdata</a> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/crawler/">Crawler</a> <a class="post-tag" href="/tags/hdfs/">HDFS</a> <a class="post-tag" href="/tags/scrapy/">Scrapy</a> <a class="post-tag" href="/tags/hadoop/">Hadoop</a> <a class="post-tag" href="/tags/apache-hadoop/">Apache Hadoop</a> <a class="post-tag" href="/tags/ubuntu/">Ubuntu</a> <a class="post-tag" href="/tags/spark-sql/">Spark SQL</a> <a class="post-tag" href="/tags/alonhadat/">alonhadat</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://demanejar.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
